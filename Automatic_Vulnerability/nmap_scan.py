import nmap

def scan(filename):
    nm = nmap.PortScanner()
    open_ports = 0
    responded_hosts = 0
    not_responded_hosts = 0
    ips_or_domains = []
    with open(filename, "r") as f:
        ips_or_domains = f.readlines()
    ips_or_domains = [x.strip() for x in ips_or_domains]
    for ip_or_domain in ips_or_domains:
        try:
            nm.scan(ip_or_domain, arguments="-sV")
            responded_hosts += 1
            log = []
            log.append("Host: %s (%s)" % (ip_or_domain, nm.all_hosts()[0]))
            for host in nm.all_hosts():
                for proto in nm[host].all_protocols():
                    log.append("Protocol: %s" % proto)
                    lport = nm[host][proto].keys()
                    for port in lport:
                        if nm[host][proto][port]["state"] == "open":
                            open_ports += 1
                            log.append("Port: %s\tState: %s\tService: %s" % (port, nm[host][proto][port]["state"], nm[host][proto][port]["name"]))
            with open("%s.txt" % ip_or_domain, "w") as f:
                f.write("\n".join(log))
        except:
            not_responded_hosts += 1
    print("\nScan results:")
    print("Number of open ports: %d" % open_ports)
    print("Number of responded hosts: %d" % responded_hosts)
    print("Number of not responded hosts: %d" % not_responded_hosts)

filename = input("Enter filename: ")
scan(filename)
